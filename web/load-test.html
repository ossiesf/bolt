<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bolt - Load Testing</title>
    <style>
        /* Copy your dark mode styles from shortener.html */
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #1a1a2e;
            color: #eee;
        }
        
        h1 {
            color: #c8b6ff;
            text-align: center;
        }
        
        .controls {
            text-align: center;
            margin: 30px 0;
        }
        
        button {
            padding: 12px 24px;
            font-size: 16px;
            background-color: #c8b6ff;
            color: #1a1a2e;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        
        button:hover {
            background-color: #b39ddb;
        }
        
        button:disabled {
            background-color: #555;
            cursor: not-allowed;
        }
        
        #results {
            margin-top: 30px;
            padding: 20px;
            background-color: #16213e;
            border-radius: 8px;
        }
        
        .metric {
            margin: 10px 0;
            padding: 10px;
            background-color: #0f3460;
            border-left: 3px solid #c8b6ff;
        }
    </style>
</head>
<body>
    <h1>Load Testing Dashboard</h1>
    
    <div class="controls">
    <label>
        Users: <input type="number" id="users" value="50" min="1" max="100">
    </label>
    <label>
        Duration (seconds): <input type="number" id="duration" value="60" min="5" max="300">
    </label>
        <br><br>
        <button id="runTest">Run Load Test</button>
    </div>
    
    <div id="results">
        <p>Results will appear here...</p>
    </div>
    
    <script>
        const runButton = document.getElementById('runTest');
        const resultsDiv = document.getElementById('results');

        runButton.addEventListener('click', async () => {
            const users = document.getElementById('users').value;
            const duration = document.getElementById('duration').value;
            
            // Disable button during test
            runButton.disabled = true;
            runButton.textContent = 'Running...';
            resultsDiv.innerHTML = '<p>Starting load test...</p>';
            
            try {
                const response = await fetch('https://improved-system-9q56x4x6vpf7p94-8000.app.github.dev/api/run-load-test', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        users: parseInt(users),
                        duration: parseInt(duration)
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    displayResults(data);
                } else {
                    resultsDiv.innerHTML = `<p style="color: red;">Error: ${data.detail || 'Failed to run test'}</p>`;
                }
            } catch (error) {
                resultsDiv.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            } finally {
                runButton.disabled = false;
                runButton.textContent = 'Run Load Test';
            }
        });

function displayResults(data) {
    let debugHtml = '';
    
    // Always show stdout/stderr
    debugHtml += `<div class="metric">
        <strong>Locust STDOUT:</strong><br>
        <pre style="white-space: pre-wrap; max-height: 300px; overflow-y: auto;">${data.locust_stdout || 'None'}</pre>
    </div>`;
    debugHtml += `<div class="metric">
        <strong>Locust STDERR:</strong><br>
        <pre style="white-space: pre-wrap; max-height: 300px; overflow-y: auto;">${data.locust_stderr || 'None'}</pre>
    </div>`;
    
    if (data.csv_error) {
        debugHtml += `<div class="metric" style="color: #ff6b6b;">
            <strong>CSV Error:</strong> ${data.csv_error}
        </div>`;
    }
    
    debugHtml += `<div class="metric">
        <strong>Return Code:</strong> ${data.return_code !== undefined ? data.return_code : 'N/A'}
    </div>`;
    
    resultsDiv.innerHTML = `
        <h2>Test Results</h2>
        ${debugHtml}
        <div class="metric">
            <strong>Total Requests:</strong> ${data.total_requests || 'N/A'}
        </div>
        <div class="metric">
            <strong>Requests/sec:</strong> ${data.requests_per_sec || 'N/A'}
        </div>
        <div class="metric">
            <strong>Average Response Time:</strong> ${data.avg_response_time || 'N/A'} ms
        </div>
        <div class="metric">
            <strong>Failures:</strong> ${data.failures || 0}
        </div>
    `;
}
    </script>
</body>
</html>